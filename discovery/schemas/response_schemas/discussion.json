{
  "name": "DiscussionSerializer",
  "source_file": "app/serializers/discussion_serializer.rb",
  "inherits_from": "ApplicationSerializer",
  "root_key": "discussions",
  "sideloaded_as": "discussions",
  "description": "Full discussion serializer with reader state merged in",
  "attributes": {
    "id": { "type": "integer", "source": "column" },
    "key": { "type": "string", "source": "column" },
    "group_id": { "type": "integer", "source": "column", "nullable": true },
    "title": { "type": "string", "source": "column", "note": "Returns nil if discarded" },
    "tags": { "type": "array", "source": "column", "items": "string" },
    "content_locale": { "type": "string", "source": "column", "nullable": true },
    "description": { "type": "string", "source": "column", "note": "Returns nil if discarded" },
    "description_format": { "type": "string", "source": "column", "enum": ["md", "html"] },
    "discussion_template_id": { "type": "integer", "source": "column", "nullable": true },
    "ranges": { "type": "string", "source": "column", "nullable": true, "note": "ranges_string column" },
    "items_count": { "type": "integer", "source": "column" },
    "last_comment_at": { "type": "datetime", "source": "column", "nullable": true },
    "last_activity_at": { "type": "datetime", "source": "column", "nullable": true },
    "closed_at": { "type": "datetime", "source": "column", "nullable": true },
    "closer_id": { "type": "integer", "source": "column", "nullable": true },
    "seen_by_count": { "type": "integer", "source": "column" },
    "members_count": { "type": "integer", "source": "column", "nullable": true },
    "created_at": { "type": "datetime", "source": "column" },
    "updated_at": { "type": "datetime", "source": "column" },
    "private": { "type": "boolean", "source": "column" },
    "versions_count": { "type": "integer", "source": "column" },
    "pinned_at": { "type": "datetime", "source": "column", "nullable": true },
    "attachments": { "type": "array", "source": "column", "items": "attachment_object" },
    "link_previews": { "type": "array", "source": "column", "items": "link_preview_object" },
    "mentioned_usernames": { "type": "array", "source": "column", "items": "string", "conditional": "description_format == 'md'" },
    "newest_first": { "type": "boolean", "source": "column" },
    "max_depth": { "type": "integer", "source": "column" },
    "discarded_at": { "type": "datetime", "source": "column", "nullable": true },
    "translation_id": { "type": "integer", "source": "method", "nullable": true }
  },
  "reader_attributes": {
    "discussion_reader_id": { "type": "integer", "source": "reader.id", "conditional": "reader.present?" },
    "discussion_reader_volume": { "type": "integer", "source": "reader", "conditional": "reader.present?" },
    "discussion_reader_user_id": { "type": "integer", "source": "reader", "conditional": "reader.present?" },
    "last_read_at": { "type": "datetime", "source": "reader", "conditional": "reader.present?", "nullable": true },
    "dismissed_at": { "type": "datetime", "source": "reader", "conditional": "reader.present?", "nullable": true },
    "read_ranges": { "type": "array", "source": "reader", "conditional": "reader.present?" },
    "revoked_at": { "type": "datetime", "source": "reader", "conditional": "reader.present?", "nullable": true },
    "inviter_id": { "type": "integer", "source": "reader", "conditional": "reader.present?", "nullable": true },
    "guest": { "type": "boolean", "source": "reader", "conditional": "reader.present?" },
    "admin": { "type": "boolean", "source": "reader", "conditional": "reader.present?" }
  },
  "relationships": {
    "author": { "serializer": "AuthorSerializer", "type": "has_one", "root": "users" },
    "group": { "serializer": "GroupSerializer", "type": "has_one", "root": "groups", "conditional": "include_type?('group') && object.group_id" },
    "active_polls": { "serializer": "PollSerializer", "type": "has_many", "root": "polls", "conditional": "include_type?('poll')" },
    "created_event": { "serializer": "EventSerializer", "type": "has_one", "root": "events", "conditional": "include_type?('event')" },
    "forked_event": { "serializer": "EventSerializer", "type": "has_one", "root": "events", "conditional": "include_type?('event')" },
    "closer": { "serializer": "AuthorSerializer", "type": "has_one", "root": "users", "conditional": "object.closer_id.present?" },
    "translation": { "serializer": "TranslationSerializer", "type": "has_one", "root": "translations" }
  },
  "notes": [
    "Uses attributes_from_reader class method to dynamically define reader-based attributes",
    "Reader is found via DiscussionReader for current_user_id",
    "title and description return nil when discarded (hide_when_discarded)"
  ]
}
