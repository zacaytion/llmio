# Group Schema
# Extracted from app/serializers/group_serializer.rb

Group:
  type: object
  description: |
    Group/organization representation. Groups can be top-level or subgroups.
    Contains permission flags, counts, and subscription info.
  properties:
    id:
      type: integer
    key:
      type: string
      description: Public group key (used in URLs)
    handle:
      type: string
      nullable: true
      description: Custom URL handle (e.g., /my-group)
    name:
      type: string
    full_name:
      type: string
      description: Includes parent name for subgroups
    description:
      type: string
      nullable: true
    description_format:
      type: string
      enum: [md, html]
    content_locale:
      type: string
      nullable: true
    created_at:
      type: string
      format: date-time
    creator_id:
      type: integer
      nullable: true

    # URLs and media
    logo_url:
      type: string
      format: uri
      nullable: true
      description: Group logo URL (inherits from parent if not set)
    cover_url:
      type: string
      format: uri
      nullable: true
      description: Cover photo URL
    has_custom_cover_photo:
      type: boolean

    # Privacy settings
    group_privacy:
      type: string
      enum: [open, closed, secret]
    is_visible_to_public:
      type: boolean
    is_visible_to_parent_members:
      type: boolean
    parent_members_can_see_discussions:
      type: boolean
    listed_in_explore:
      type: boolean
    discussion_privacy_options:
      type: string
      description: Allowed privacy options for discussions
    membership_granted_upon:
      type: string
      enum: [request, approval, invitation]

    # Member permission flags
    members_can_add_members:
      type: boolean
    members_can_add_guests:
      type: boolean
    members_can_announce:
      type: boolean
    members_can_create_subgroups:
      type: boolean
    members_can_start_discussions:
      type: boolean
    members_can_edit_discussions:
      type: boolean
    members_can_edit_comments:
      type: boolean
    members_can_delete_comments:
      type: boolean
    members_can_raise_motions:
      type: boolean

    # Admin flags
    admins_can_edit_user_content:
      type: boolean

    # Counts
    memberships_count:
      type: integer
    pending_memberships_count:
      type: integer
    accepted_memberships_count:
      type: integer
    admin_memberships_count:
      type: integer
    delegates_count:
      type: integer
    discussions_count:
      type: integer
    open_discussions_count:
      type: integer
    closed_discussions_count:
      type: integer
    public_discussions_count:
      type: integer
    polls_count:
      type: integer
    closed_polls_count:
      type: integer
    subgroups_count:
      type: integer
    recent_activity_count:
      type: integer
    discussion_templates_count:
      type: integer
    poll_templates_count:
      type: integer

    # Organization-level counts (parent groups only)
    org_discussions_count:
      type: integer
      description: Only present for parent groups
    org_members_count:
      type: integer
      description: Only present for parent groups

    # Template settings
    new_threads_max_depth:
      type: integer
    new_threads_newest_first:
      type: boolean
    categorize_poll_templates:
      type: boolean
    category:
      type: string
      nullable: true
    request_to_join_prompt:
      type: string
      nullable: true
    can_start_polls_without_discussion:
      type: boolean

    # Token (conditional - only when include_token scope is set)
    token:
      type: string
      description: Group invite token (admin only)

    # State
    archived_at:
      type: string
      format: date-time
      nullable: true

    # Rich content
    attachments:
      type: array
      items:
        $ref: '#/Attachment'
    link_previews:
      type: array
      items:
        $ref: '#/LinkPreview'

    # Subscription info
    subscription:
      $ref: '#/Subscription'

    # Redirect info
    new_host:
      type: string
      nullable: true
      description: If group has moved to a new host

  required:
    - id
    - key
    - name
    - group_privacy

Subscription:
  type: object
  description: Group subscription/plan information
  properties:
    max_members:
      type: integer
      nullable: true
    max_threads:
      type: integer
      nullable: true
    allow_subgroups:
      type: boolean
    plan:
      type: string
    state:
      type: string
    active:
      type: boolean
    renews_at:
      type: string
      format: date-time
      nullable: true
    expires_at:
      type: string
      format: date-time
      nullable: true
    members_count:
      type: integer

Attachment:
  type: object
  description: File attachment metadata
  properties:
    id:
      type: integer
    filename:
      type: string
    content_type:
      type: string
    byte_size:
      type: integer
    url:
      type: string
      format: uri
    thumb_url:
      type: string
      format: uri
      nullable: true
    icon:
      type: string
    download_url:
      type: string
      format: uri
    signed_id:
      type: string

LinkPreview:
  type: object
  description: Extracted link preview metadata
  properties:
    url:
      type: string
      format: uri
    hostname:
      type: string
    title:
      type: string
      nullable: true
    description:
      type: string
      nullable: true
    image:
      type: string
      format: uri
      nullable: true
    rich_preview:
      type: object
      nullable: true
      additionalProperties: true
